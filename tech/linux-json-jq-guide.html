<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="applicable-device" content="pc,mobile">
  <meta name="keywords" content="jq, JSON å¤„ç†, Linux è¿ç»´, K8S, Docker, API æ•°æ®æå–, æ—¥å¿—åˆ†æ, Kubernetes, å‘½ä»¤è¡Œå·¥å…·, è¿ç»´å®æˆ˜" />
  <meta name="description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Linux ä¸­å¼ºå¤§çš„ JSON å¤„ç†å·¥å…· jqï¼Œæ¶µç›–åŸºç¡€æ“ä½œã€æ•°ç»„å¤„ç†ã€å®æˆ˜åœºæ™¯åŠè¿›é˜¶æŠ€å·§ï¼ŒåŠ©ä½ åœ¨ K8S/Docker è¿ç»´ä¸­é«˜æ•ˆå¤„ç† JSON æ•°æ®ã€‚" />
  <link rel="alternate" type="application/rss+xml" title="è¿ç»´ä¸åŠ ç­" href="https://blog.opsnot.com/feed.xml" />
  <link rel="stylesheet" href="https://blog.opsnot.com/static/posts/css/ops-coffee.min.css" type="text/css" />

  <!-- Begin SEO tag -->
  <title>LINUX JSONå¤„ç†ï¼Œ jq å‘½ä»¤è¡Œå·¥å…·å®æˆ˜æŒ‡å—ï¼</title>
  <meta property="og:locale" content="zh_CN" />
  <meta property="og:site_name" content="è¿ç»´ä¸åŠ ç­" />
  <meta property="og:url" content="https://blog.opsnot.comtech/linux-json-jq-guide.html" />
  <meta property="og:title" content="LINUX JSONå¤„ç†ï¼Œ jq å‘½ä»¤è¡Œå·¥å…·å®æˆ˜æŒ‡å—ï¼" />
  <meta property="og:description" content="æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Linux ä¸­å¼ºå¤§çš„ JSON å¤„ç†å·¥å…· jqï¼Œæ¶µç›–åŸºç¡€æ“ä½œã€æ•°ç»„å¤„ç†ã€å®æˆ˜åœºæ™¯åŠè¿›é˜¶æŠ€å·§ï¼ŒåŠ©ä½ åœ¨ K8S/Docker è¿ç»´ä¸­é«˜æ•ˆå¤„ç† JSON æ•°æ®ã€‚" />
  <link rel="canonical" href="https://blog.opsnot.comtech/linux-json-jq-guide.html" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "headline": "LINUX JSONå¤„ç†ï¼Œ jq å‘½ä»¤è¡Œå·¥å…·å®æˆ˜æŒ‡å—ï¼",
    "description": "æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Linux ä¸­å¼ºå¤§çš„ JSON å¤„ç†å·¥å…· jqï¼Œæ¶µç›–åŸºç¡€æ“ä½œã€æ•°ç»„å¤„ç†ã€å®æˆ˜åœºæ™¯åŠè¿›é˜¶æŠ€å·§ï¼ŒåŠ©ä½ åœ¨ K8S/Docker è¿ç»´ä¸­é«˜æ•ˆå¤„ç† JSON æ•°æ®ã€‚",
    "url": "https://blog.opsnot.comtech/linux-json-jq-guide.html",
    "author": {
      "@type": "Person",
      "name": "è¿ç»´ä¸åŠ ç­"
    },
    "publisher": {
      "@type": "Organization",
      "name": "è¿ç»´ä¸åŠ ç­",
      "logo": {
        "@type": "ImageObject",
        "url": "https://blog.opsnot.com/favicon.ico"
      }
    },
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": "https://blog.opsnot.comtech/linux-json-jq-guide.html"
    }
  }
  </script>
  <!-- End SEO tag -->
</head>

<body>
  <div class="header">
    <div class="menu-button">&#9776; 
        <span class="menu-title">è¿ç»´å’–å•¡å§</span>
    </div> 

    <div class="container">
      <nav class="header-site">
        <ul>
          <li><a href="/">é¦–é¡µ</a></li>
            <li><a href="/tag/index.html" target="_self">æ ‡ç­¾</a></li>
            <li><a href="/archive.html" target="_self">å½’æ¡£</a></li>
          <li class="search"><a href="/search.html" target="_self" aria-label="æœç´¢">ğŸ”</a></li>
        </ul>
      </nav>
    </div>
  </div>

  <header>
    <div class="container">
      <a href="/">
        <div class="name">è¿ç»´ä¸åŠ ç­</div>
        <div class="slogan">å”¯æœ‰çƒ­çˆ±ï¼Œæ–¹èƒ½æˆå°±éå‡¡ï¼Œè‹¥æ— ç—´è¿·ï¼Œå²‚èƒ½çª¥å¾—å¤©æœº</div>
      </a>
    </div>
  </header>

  <div id="content-wrap">
    <div class="container">
        <h1 id="art-title">LINUX JSONå¤„ç†ï¼Œ jq å‘½ä»¤è¡Œå·¥å…·å®æˆ˜æŒ‡å—ï¼</h1>

        <p><code>JSON</code> å¤„ç†æ˜¯è¿ç»´çš„å¸¸è§æ“ä½œï¼Œ<code>API</code> è¿”å›ã€é…ç½®æ–‡ä»¶ã€æ—¥å¿—åˆ†æç­‰éƒ½ä¼šæ¶‰åŠåˆ°å®ƒ<br>
å°¤å…¶æ˜¯ <code>K8S/Docker</code> è¿ç»´åœºæ™¯ä¸­ï¼Œ<code>JSON</code> æ•°æ®å¤„ç†æ›´æ˜¯å®¶å¸¸ä¾¿é¥­ï¼Œæœ¬æ–‡å°±ä»‹ç»ä¸ª <code>Linux JSON</code> æ•°æ®å¤„ç†ç¥å™¨ â€”â€” <code>jq</code><br>
è¿™ä¸ªå‘½ä»¤è¡Œå·¥å…·, åœ¨å¤„ç† <code>JSON</code> æ—¶æ¯” <code>grep</code>ã€<code>awk</code>å¼ºå¤§å¤ªå¤šï¼Œæ‰€è°“ä¸“ä¸šå¯¹å£å°±æ˜¯å¦‚æ­¤ï¼<br>
è¯ä¸å¤šè¯´ï¼Œå¼€æ•´ï¼</p>
<h2 id="1">1. åŸºç¡€æ“ä½œ</h2>
<h3 id="11">1.1 æ ¼å¼åŒ–è¾“å‡º</h3>
<pre class="codehilite"><code class="language-bash"># æœ€å¸¸ç”¨çš„åŠŸèƒ½,æŠŠå‹ç¼©çš„ JSON æ ¼å¼åŒ–æˆäººèƒ½çœ‹çš„æ ·å­:
# ç¾åŒ– API è¿”å›ç»“æœ
curl -s https://api.opsnot.com/users | jq '.'

# å¤„ç†æ–‡ä»¶
cat opsnot.json | jq '.'</code></pre>


<h3 id="12">1.2 æå–å­—æ®µ</h3>
<pre class="codehilite"><code class="language-bash"># æå–å•ä¸ªå­—æ®µ
echo '{&quot;name&quot;:&quot;opsnot&quot;,&quot;age&quot;:30}' | jq '.name'
# è¾“å‡º: &quot;opsnot&quot;

# æå–åµŒå¥—å­—æ®µ
echo '{&quot;user&quot;:{&quot;name&quot;:&quot;opsnot&quot;}}' | jq '.user.name'

# æ•°ç»„ç´¢å¼•
echo '[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]' | jq '.[1]'
# è¾“å‡º: &quot;b&quot;</code></pre>


<h3 id="13">1.3 å»æ‰å¼•å·</h3>
<pre class="codehilite"><code class="language-bash"># é»˜è®¤å­—ç¬¦ä¸²å¸¦å¼•å·,åŠ  `-r` å‚æ•°å»æ‰:
echo '{&quot;domain&quot;:&quot;opsnot.com&quot;}' | jq -r '.domain'
# è¾“å‡º: opsnot.com (æ²¡æœ‰å¼•å·)</code></pre>


<h2 id="2">2. æ•°ç»„å¤„ç†</h2>
<h3 id="21">2.1 éå†æ•°ç»„</h3>
<pre class="codehilite"><code class="language-bash"># ç”¨æˆ·åˆ—è¡¨,æå–æ‰€æœ‰ç”¨æˆ·å
echo '[{&quot;name&quot;:&quot;tom&quot;},{&quot;name&quot;:&quot;jerry&quot;}]' | jq '.[].name'

# é…åˆ -r ç›´æ¥ç”¨
kubectl get pods -o json | jq -r '.items[].metadata.name'</code></pre>


<h3 id="22">2.2 è¿‡æ»¤ç­›é€‰</h3>
<pre class="codehilite"><code class="language-bash"># ç­›é€‰ status ä¸º active çš„è®°å½•
jq '.users[] | select(.status == &quot;active&quot;)' users.json

# ç­›é€‰ç«¯å£å¤§äº 8000 çš„æœåŠ¡ (æ¥è‡ª opsnot ç›‘æ§ç³»ç»Ÿ)
# æ³¨æ„: å¦‚æœ port æ˜¯å­—ç¬¦ä¸²éœ€è¦å…ˆè½¬æˆæ•°å­—
jq '.services[] | select((.port | tonumber) &gt; 8000)' config.json

# å¤šæ¡ä»¶
jq '.[] | select(.age &gt; 25 and .city == &quot;beijing&quot;)' data.json</code></pre>


<h3 id="23">2.3 æ•°ç»„åˆ‡ç‰‡</h3>
<pre class="codehilite"><code class="language-bash"># å–å‰ 3 ä¸ª
echo '[1,2,3,4,5]' | jq '.[:3]'

# å–å 2 ä¸ª
echo '[1,2,3,4,5]' | jq '.[-2:]'</code></pre>


<h2 id="3">3. å®æˆ˜åœºæ™¯</h2>
<h3 id="31-docker">3.1 åˆ†æ Docker å®¹å™¨çŠ¶æ€</h3>
<pre class="codehilite"><code class="language-bash"># æ‰¾å‡ºæ‰€æœ‰è¿è¡Œä¸­çš„å®¹å™¨åç§° (å»æ‰å‰å¯¼æ–œæ )
docker ps -q | xargs docker inspect | jq -r '.[].Name | ltrimstr(&quot;/&quot;)'

# åŠ ç­å“¥æé†’ï¼šå½“å®¹å™¨è¿‡å¤šæ—¶ï¼Œé˜²æ­¢å‘½ä»¤è¡Œå‚æ•°è¶…é•¿ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ç§æ›´å®‰å…¨ç¨³å¦¥çš„æ–¹å¼
docker ps --format &quot;{{.ID}}&quot; | while read id; do
    docker inspect &quot;$id&quot; | jq -r '.[].Name | ltrimstr(&quot;/&quot;)'
done

# æ‰¾å‡ºå ç”¨ç«¯å£ 80 çš„å®¹å™¨
docker ps -q | xargs docker inspect | \
  jq -r '.[] | select(.NetworkSettings.Ports.&quot;80/tcp&quot; != null) | 
         .Name | ltrimstr(&quot;/&quot;)'</code></pre>


<p>æ›´å¤š <code>docker</code> é«˜é¢‘å®æ“å‘½ä»¤ï¼Œè¯·çœ‹å¦å¤–ä¸¤ç¯‡ï¼š<br> <a href="https://blog.opsnot.com/tech/docker-commands-cheat-sheet.html" target="_blank">Dockeré«˜é¢‘å‘½ä»¤å®æ“æ‰‹å†Œï¼Œå€¼å¾—æ”¶è—ï¼</a><br>
<a href="https://blog.opsnot.com/tech/docker-inspect-guide.html" target="_blank">Docker Inspectï¼Œå€¼å¾—æ—è°±å•å¼€ä¸€é¡µçš„å‘½ä»¤</a></p>
<h3 id="32-kubernetes">3.2 å¤„ç† Kubernetes èµ„æº</h3>
<pre class="codehilite"><code class="language-bash"># åˆ—å‡ºæ‰€æœ‰ Pod çš„åç§°å’Œ IP
kubectl get pods -o json | \
  jq -r '.items[] | &quot;\(.metadata.name) \(.status.podIP)&quot;'

# æ‰¾å‡ºé Running çŠ¶æ€çš„ Pod
kubectl get pods -o json | \
  jq -r '.items[] | select(.status.phase != &quot;Running&quot;) | .metadata.name'

# ç»Ÿè®¡å„å‘½åç©ºé—´çš„ Pod æ•°é‡ (opsnot é›†ç¾¤å·¡æ£€è„šæœ¬)
kubectl get pods --all-namespaces -o json | \
  jq -r '.items | group_by(.metadata.namespace) | 
         .[] | &quot;\(.[0].metadata.namespace): \(length)&quot;'</code></pre>


<p>æ›´å¤š <code>k8S</code> é«˜é¢‘å®æ“å‘½ä»¤ï¼Œè¯·çœ‹å¦å¤–ä¸¤ç¯‡ï¼š<br> <a href="https://blog.opsnot.com/tools/kubernetes-commands-for-daily-use.html" target="_blank">K8sé«˜é¢‘å‘½ä»¤å®æ“æ‰‹å†Œï¼Œå€¼å¾—æ”¶è—ï¼</a><br>
<a href="https://blog.opsnot.com/tech/kubectl-describe-command-guide.html" target="_blank">Kubectl Describeï¼Œk8sæ•…éšœæ’æŸ¥åˆ©å™¨ï¼</a></p>
<h3 id="33">3.3 æ—¥å¿—åˆ†æ</h3>
<pre class="codehilite"><code class="language-bash"># ä» JSON æ ¼å¼æ—¥å¿—ä¸­æå–é”™è¯¯ä¿¡æ¯
cat app.log | jq -r 'select(.level==&quot;ERROR&quot;) | .message'

# ç»Ÿè®¡æ¥å£å“åº”æ—¶é—´è¶…è¿‡ 1 ç§’çš„è¯·æ±‚
cat access.log | jq -r 'select(.response_time &gt; 1000) | 
  &quot;\(.timestamp) \(.path) \(.response_time)ms&quot;'

# æŒ‰çŠ¶æ€ç åˆ†ç»„ç»Ÿè®¡ (opsnot.com è®¿é—®æ—¥å¿—, è¿™é‡Œéœ€è¦é…ç½®nginxæ—¥å¿—æ ¼å¼ä¸ºjsonæ ¼å¼)
cat nginx.log | jq -s 'group_by(.status) | 
  .[] | {status: .[0].status, count: length}'</code></pre>


<h3 id="34-api">3.4 API æ•°æ®æå–</h3>
<pre class="codehilite"><code class="language-bash"># GitHub API - åˆ—å‡ºä»“åº“ Star æ•°
curl -s https://api.github.com/users/opsnot/repos | \
  jq -r '.[] | &quot;\(.name): \(.stargazers_count) stars&quot;'

# æå–æ‰€æœ‰ SSH å…‹éš†åœ°å€
curl -s https://api.github.com/users/opsnot/repos | \
  jq -r '.[].ssh_url'</code></pre>


<h3 id="35-json">3.5 æ„é€ æ–° JSON</h3>
<pre class="codehilite"><code class="language-bash"># é‡ç»„å­—æ®µ
jq '{username: .name, email: .contact.email}' users.json

# æ‰¹é‡ç”Ÿæˆé…ç½®æ–‡ä»¶
cat servers.json | jq -r '.[] | 
  &quot;Host \(.name)\n  HostName \(.ip)\n  User opsnot\n&quot;' &gt; ~/.ssh/config.d/auto</code></pre>


<h2 id="4">4. è¿›é˜¶æŠ€å·§</h2>
<h3 id="41">4.1 ç®¡é“æ“ä½œ</h3>
<pre class="codehilite"><code class="language-bash"># å…ˆè¿‡æ»¤å†æå–
jq '.users[] | select(.age &gt; 30) | .name' data.json

# å¤šçº§å¤„ç†
jq '.data.items[] | select(.price &lt; 100) | {name, price}' products.json</code></pre>


<h3 id="42">4.2 æ•°ç»„æ“ä½œ</h3>
<pre class="codehilite"><code class="language-bash"># map - æ‰¹é‡è½¬æ¢
echo '[1,2,3]' | jq 'map(. * 2)'
# è¾“å‡º: [2,4,6]

# æ•°ç»„é•¿åº¦
jq '.users | length' data.json

# å»é‡
jq '[.[] | .city] | unique' users.json

# æ’åº
jq 'sort_by(.price)' products.json</code></pre>


<h3 id="43">4.3 æ¡ä»¶åˆ¤æ–­</h3>
<pre class="codehilite"><code class="language-bash"># if-then-else
jq '.[] | if .age &gt;= 18 then &quot;adult&quot; else &quot;minor&quot; end' users.json

# ç©ºå€¼å¤„ç† (opsnot æ•°æ®æ¸…æ´—è„šæœ¬)
jq '.email // &quot;no-email@opsnot.com&quot;' users.json</code></pre>


<h3 id="44">4.4 å­—ç¬¦ä¸²å¤„ç†</h3>
<pre class="codehilite"><code class="language-bash"># æ‹¼æ¥å­—ç¬¦ä¸²
jq '.name + &quot;@opsnot.com&quot;' users.json

# åˆ†å‰²
echo '{&quot;path&quot;:&quot;/var/log/app.log&quot;}' | jq -r '.path | split(&quot;/&quot;) | .[-1]'

# æ­£åˆ™åŒ¹é…
jq 'select(.email | test(&quot;.*@opsnot\\.com$&quot;))' users.json</code></pre>


<h2 id="5">5. æ€§èƒ½ä¼˜åŒ–</h2>
<h3 id="51">5.1 æµå¼å¤„ç†å¤§æ–‡ä»¶</h3>
<pre class="codehilite"><code class="language-bash"># å¤„ç† GB çº§åˆ«çš„æ—¥å¿—,ä¸è¦ç”¨ jq -s è¯»å…¥å†…å­˜
cat huge.json | jq -c '.[] | select(.error != null)'</code></pre>


<h3 id="52">5.2 å‡å°‘ç®¡é“æ¬¡æ•°</h3>
<pre class="codehilite"><code class="language-bash"># ä¸å¥½çš„å†™æ³•
cat data.json | jq '.[]' | jq 'select(.age &gt; 30)' | jq '.name'

# å¥½çš„å†™æ³•
jq '.[] | select(.age &gt; 30) | .name' data.json</code></pre>


<h2 id="6">6. å¸¸è§å‘ç‚¹</h2>
<h3 id="61">6.1 å¼•å·é—®é¢˜</h3>
<pre class="codehilite"><code class="language-bash"># é”™è¯¯: å•å¼•å·é‡Œä¸èƒ½ç”¨å˜é‡
user=&quot;opsnot&quot;
jq &quot;.name == \&quot;$user\&quot;&quot; users.json  # å¯ä»¥ä½†ä¸å®‰å…¨

# æ¨è: ç”¨ --arg é¿å…æ³¨å…¥é£é™©
jq --arg u &quot;$user&quot; '.name == $u' users.json

# ä¼ é€’å¤šä¸ªå˜é‡
jq --arg name &quot;$name&quot; --arg domain &quot;$domain&quot; 
   '.user = $name | .email = $name + &quot;@&quot; + $domain' config.json

# ä¼ é€’æ•°å­—å˜é‡
jq --argjson port 8000 '.port == $port' config.json</code></pre>


<h3 id="62">6.2 æ•°ç»„ä¸ºç©ºçš„å¤„ç†</h3>
<pre class="codehilite"><code class="language-bash"># é¿å…æŠ¥é”™
jq '.items[]? | .name' data.json  # åŠ  ? å·

# æˆ–æä¾›é»˜è®¤å€¼
jq '.items // []' data.json</code></pre>


<h3 id="63">6.3 æ•°å­—å’Œå­—ç¬¦ä¸²</h3>
<pre class="codehilite"><code class="language-bash"># ç«¯å£å·æ˜¯å­—ç¬¦ä¸²æ—¶éœ€è¦è½¬æ¢
jq '.[] | select((.port | tonumber) &gt; 8000)' config.json

# å­—ç¬¦ä¸²è½¬æ•°å­—
echo '{&quot;count&quot;:&quot;42&quot;}' | jq '.count | tonumber'

# æ•°å­—è½¬å­—ç¬¦ä¸²
echo '{&quot;count&quot;:42}' | jq '.count | tostring'</code></pre>


<h3 id="64">6.4 é”™è¯¯å¤„ç†</h3>
<pre class="codehilite"><code class="language-bash"># éªŒè¯ JSON æ˜¯å¦åˆæ³•
json='{&quot;data&quot;: &quot;test&quot;}'
if echo &quot;$json&quot; | jq -e . &gt;/dev/null 2&gt;&amp;1; then
    echo &quot;Valid JSON&quot;
else
    echo &quot;Invalid JSON from opsnot.com API&quot; &gt;&amp;2
    exit 1
fi

# å¤„ç†å¯èƒ½ä¸å­˜åœ¨çš„å­—æ®µ
jq '.user.email // &quot;no-reply@opsnot.com&quot;' data.json

# å®‰å…¨è®¿é—®æ•°ç»„,é¿å…ç©ºæ•°ç»„æŠ¥é”™
jq '.items[]?' data.json</code></pre>


<h2 id="7">7. é«˜çº§ç‰¹æ€§</h2>
<h3 id="71">7.1 è‡ªå®šä¹‰å‡½æ•°</h3>
<pre class="codehilite"><code class="language-bash"># å®šä¹‰å‡½æ•°å¤ç”¨é€»è¾‘
echo '{&quot;users&quot;:[{&quot;email&quot;:&quot;alice&quot;},{&quot;email&quot;:&quot;bob&quot;}]}' | jq '
  def add_domain: . + &quot;@opsnot.com&quot;;
  .users[].email | add_domain
'

# å¸¦å‚æ•°çš„å‡½æ•°
echo '{&quot;prices&quot;:[10,20,30]}' | jq '
  def multiply($n): . * $n;
  .prices[] | multiply(1.1)
'</code></pre>


<h3 id="72">7.2 é€’å½’å¤„ç†</h3>
<pre class="codehilite"><code class="language-bash"># é€’å½’æŸ¥æ‰¾æ‰€æœ‰ name å­—æ®µ
jq '.. | .name? // empty' complex.json

# é€’å½’éå†æ ‘å½¢ç»“æ„
jq 'recurse(.children[]?) | .id' tree.json</code></pre>


<h3 id="73">7.3 å¤æ‚æŸ¥è¯¢çš„å¯è¯»æ€§</h3>
<pre class="codehilite"><code class="language-bash"># ç”¨ heredoc å¤„ç†å¤šè¡Œå¤æ‚æŸ¥è¯¢
jq -n --slurpfile config config.json '
  $config[0] | 
  .services[] | 
  select(.enabled == true) |
  select(.env == &quot;prod&quot;) |
  &quot;\(.name):\(.port) # opsnot.com&quot;
'

# æˆ–è€…ä½¿ç”¨è¾“å…¥é‡å®šå‘ï¼š
jq '.services[] | select(.enabled == true) | select(.env == &quot;prod&quot;) | &quot;\(.name):\(.port)&quot;' config.json</code></pre>


<h3 id="74">7.4 ç»„åˆæ‹³</h3>
<p>è¿ç»´å®æˆ˜ä¸­ç»å¸¸è¦ç»„åˆä½¿ç”¨:</p>
<pre class="codehilite"><code class="language-bash"># æ‰¾å‡º CPU ä½¿ç”¨ç‡æœ€é«˜çš„ 5 ä¸ªå®¹å™¨ (opsnot ç›‘æ§å‘Šè­¦)
docker stats --no-stream --format &quot;{{json .}}&quot; | \
  jq -R 'fromjson? | select(.CPUPerc != null)' | \
  jq -s 'sort_by(.CPUPerc | rtrimstr(&quot;%&quot;) | tonumber) | 
         reverse | .[:5] | 
         .[] | &quot;\(.Name): \(.CPUPerc)&quot;'

# ä» ELB æ—¥å¿—ä¸­ç»Ÿè®¡æ…¢è¯·æ±‚çš„ URL åˆ†å¸ƒ
cat elb.log | \
  jq -r 'select(.response_time &gt; 1) | .request_url' | \
  sort | uniq -c | sort -rn | head -20

# ç”Ÿæˆ Prometheus æ‰¹é‡ç›‘æ§é…ç½®
cat servers.json | \
  jq -r '.[] | 
    &quot;  - job_name: \&quot;\(.name)\&quot;&quot;,
    &quot;    static_configs:&quot;,
    &quot;      - targets: [\&quot;\(.ip):9100\&quot;]&quot;, 
    &quot;        labels:&quot;,
    &quot;          env: \(.env)&quot;,
    &quot;          # by opsnot.com&quot;'</code></pre>


<h2 id="8">8. è°ƒè¯•æŠ€å·§</h2>
<pre class="codehilite"><code class="language-bash"># è°ƒè¯•å¤æ‚è¡¨è¾¾å¼,æŸ¥çœ‹ä¸­é—´ç»“æœ
jq 'debug | .users[] | select(.age &gt; 30)' data.json

# é€æ­¥æ„å»ºå¤æ‚æŸ¥è¯¢
jq '.' data.json           # å…ˆçœ‹æ•´ä½“ç»“æ„
jq '.users' data.json      # å†çœ‹ç‰¹å®šå­—æ®µ
jq '.users[]' data.json    # éå†æ•°ç»„
jq '.users[].name' data.json  # æœ€ç»ˆæå–

# æŸ¥çœ‹ç±»å‹
echo '{&quot;port&quot;:&quot;8080&quot;}' | jq '.port | type'  # è¾“å‡º: &quot;string&quot;</code></pre>


<h2 id="9">9. æ€§èƒ½å’Œé™åˆ¶</h2>
<h3 id="91">9.1 æ€§èƒ½ä¼˜åŒ–</h3>
<pre class="codehilite"><code class="language-bash"># ä½¿ç”¨ -c å‹ç¼©è¾“å‡ºå‡å°‘å†…å­˜
jq -c '.' large-file.json

# é¿å…é‡å¤è§£æåŒä¸€æ–‡ä»¶
config=$(jq '.' config.json)
echo &quot;$config&quot; | jq '.db.host'
echo &quot;$config&quot; | jq '.app.port'

# æµå¼å¤„ç†é¿å…å†…å­˜çˆ†ç‚¸
cat opsnot.log | jq -c 'select(.error)' &gt; errors.log</code></pre>


<h3 id="92-jq">9.2 <code>jq</code>çš„å±€é™</h3>
<pre class="codehilite"><code class="language-bash">å¤„ç†è¶…å¤§æ–‡ä»¶ (GB çº§) æ—¶æ€§èƒ½æœ‰é™ï¼Œéœ€è¦åˆ†å‰²æ–‡ä»¶
ä¸æ”¯æŒå°±åœ°ä¿®æ”¹æ–‡ä»¶ï¼Œéœ€è¦é‡å®šå‘è¾“å‡º
å¤æ‚é€»è¾‘ä¸å¦‚ç¼–ç¨‹è¯­è¨€çµæ´»ï¼Œæ¯”å¦‚ç”¨py</code></pre>


<h3 id="93">9.3 å…¶ä»–</h3>
<pre class="codehilite"><code class="language-bash"># Python å¤„ç†å¤æ‚é€»è¾‘
python3 -m json.tool &lt; data.json

# å¤„ç† JSON Lines æ ¼å¼
cat data.jsonl | jq -c '.'

# ç¨³å¥ä¸€ç‚¹ï¼Œå¦‚æœæŸè¡Œä¸æ˜¯åˆæ³• JSONï¼Œjq ä¼šæŠ¥é”™å¹¶è·³è¿‡
cat data.jsonl | jq -c '.' 2&gt;/dev/null
# è¿™æ ·åªè¾“å‡ºæœ‰æ•ˆçš„ JSON è¡Œ</code></pre>


<h2 id="_1">æ€»ç»“:</h2>
<p><code>jq</code> çš„æ ¸å¿ƒæ˜¯ç®¡é“å’Œè¿‡æ»¤ï¼Œä»å·¦åˆ°å³æ€è€ƒæ•°æ®æµã€‚æ—¥å¸¸å¤šç”¨è‡ªç„¶é¡ºæ‰‹ï¼Œå¤æ‚åœºæ™¯å°±æ‹†æˆå°æ­¥éª¤ã€‚è®°å¾—ç”¨ <code>--arg</code> ä¼ å‚æ•°ã€<code>-e</code> æ ¡éªŒ <code>JSON</code>ã€å¤„ç†å¥½ç©ºå€¼å’Œç±»å‹è½¬æ¢ã€‚</p>
<p><strong>æœ€ä½³å®è·µï¼š</strong>
- å…ˆç”¨ <code>jq -e .</code> éªŒè¯ <code>JSON</code> åˆæ³•æ€§
- ç”¨ <code>--arg</code> ä¼ é€’å¤–éƒ¨å˜é‡,é¿å…æ³¨å…¥
- å¤§æ–‡ä»¶ç”¨ <code>-c</code> æµå¼å¤„ç†
- å¤„ç†æ•°ç»„æ—¶åŠ  <code>?</code> é˜²æ­¢ç©ºæ•°ç»„æŠ¥é”™
- å­—ç¬¦ä¸²å’Œæ•°å­—æ¯”è¾ƒè®°å¾—<code>tonumber</code></p>
<h2 id="jq"><code>jq</code> å‚æ•°é€ŸæŸ¥è¡¨</h2>
<pre class="codehilite"><code class="language-bash"># å¸¸ç”¨å‚æ•°
-r, --raw-output          # è¾“å‡ºåŸå§‹å­—ç¬¦ä¸²,å»æ‰å¼•å·
-c, --compact-output      # å‹ç¼©è¾“å‡º,ä¸æ ¼å¼åŒ–
-e, --exit-status         # æ ¹æ®è¾“å‡ºè®¾ç½®é€€å‡ºç ,ç”¨äºæ ¡éªŒ
-s, --slurp               # è¯»å–æ•´ä¸ªè¾“å…¥æµä¸ºä¸€ä¸ªæ•°ç»„
-n, --null-input          # ä¸è¯»å–è¾“å…¥,ä» null å¼€å§‹
-j, --join-output         # è¾“å‡ºä¸æ¢è¡Œ
-S, --sort-keys           # è¾“å‡ºæ—¶å¯¹å¯¹è±¡çš„é”®æ’åº
--stream                  # æµå¼è§£æå¤§ JSON æ–‡ä»¶
--seq                     # ä½¿ç”¨ RS åˆ†éš”ç¬¦çš„è¾“å…¥æ¨¡å¼

# ä¼ é€’å‚æ•° (opsnot.com æ¨è)
--arg name value          # ä¼ é€’å­—ç¬¦ä¸²å˜é‡: $name
--argjson name json       # ä¼ é€’ JSON å˜é‡: $name  
--slurpfile name file     # è¯»å–æ–‡ä»¶ä¸ºæ•°ç»„: $name

# è¾“å‡ºæ§åˆ¶
-C, --color-output        # å½©è‰²è¾“å‡º (é»˜è®¤)
-M, --monochrome-output   # å•è‰²è¾“å‡º
--tab                     # ç”¨ tab ç¼©è¿›ä»£æ›¿ç©ºæ ¼
--indent n                # è®¾ç½®ç¼©è¿›ç©ºæ ¼æ•°

# ç¨‹åºæ–‡ä»¶
-f file, --from-file file # ä»æ–‡ä»¶è¯»å– jq ç¨‹åº
-L directory              # æ·»åŠ æ¨¡å—æœç´¢è·¯å¾„

# ç¤ºä¾‹
jq -r '.name' data.json                    # è¾“å‡ºåŸå§‹å­—ç¬¦ä¸²
jq -c '.' data.json                        # å‹ç¼©æˆä¸€è¡Œ
jq -e '.error' data.json &amp;&amp; echo &quot;æœ‰é”™è¯¯&quot;  # æ ¡éªŒå­—æ®µå­˜åœ¨
cat file1.json file2.json | jq -s '.'      # åˆå¹¶å¤šä¸ªæ–‡ä»¶
jq --arg env prod '.[$env]' config.json    # ä½¿ç”¨å˜é‡è®¿é—®å±æ€§</code></pre>


<p>æ›´å¤šè¿ç»´æŠ€æœ¯è¯·ç‚¹å‡»å·¦ä¸‹æ–¹ <code>é˜…è¯»åŸæ–‡</code></p>
<blockquote>
<p>æœ¬æ–‡ç”± opsnot.com æ•´ç†ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼Œç‚¹å‡»ä¸‹æ–¹å¡ç‰‡å…³æ³¨</p>
</blockquote>

        <div>
          <ul style="display: inline-block;padding: 0;margin: 0 0 0.5em;color: #999;">
            <li style="display: inline-block;margin: 0 1em 0 0;"><a href="/tech/linux-json-jq-guide.html">ğŸ“… 2025-11-04</a></li>
          </ul>
        </div>

        <hr>

        <div class="pagination">
            <a href="https://blog.opsnot.com/tech/strace-guide-system-call-tracing.html" class="pagination-item prev-page">
                <span class="pagination-arrow">â†</span>
                <span class="pagination-text">ä¸Šä¸€ç¯‡ï¼š<br>Straceå‘½ä»¤ï¼ŒLinuxç³»ç»Ÿè°ƒç”¨è¿½è¸ªç¥å™¨ï¼</span>
            </a>
            <a href="/archive.html" class="pagination-item next-page">
                <span class="pagination-text">ä¸‹ä¸€ç¯‡ï¼š<br>æ–‡ç« åˆ—è¡¨</span>
                <span class="pagination-arrow">â†’</span>
            </a>
        </div>

        

        

        <div class="nav-cell">
            <p class="nav-list-title">èƒ½çœ‹åˆ°è¿™é‡Œä¸€å®šæ˜¯çœŸçˆ±ï¼Œè®¢é˜…ä¸€ä¸‹å§</p>
            <img alt="" loading="lazy" src="/static/images/wx.sou1.png" />
        </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="copy"> Â© ops-coffee</div>

      <div class="link">
        <a href="/comments.html" title="ç»™æˆ‘ç•™è¨€" target="_blank">ç•™è¨€</a>
        <a href="/friends.html" title="å‹æƒ…é“¾æ¥" target="_blank">å‹é“¾</a>
      </div>
    </div>
  </footer>
  
  <script defer src="https://umami.opsnot.com/script.js" data-website-id="b1df419f-de4e-4b55-82fc-2aebae58afc7"></script>
</body>
</html>